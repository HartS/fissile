FROM {{ index . "base_image" }}

MAINTAINER hcf@hpe.com

{{ with $context := . }}
{{ with $role := index . "role" }}
{{ with $job := index $role.Jobs 0}}
LABEL "role"="{{ $role.Name }}" "release-version"="{{ $job.Release.Version }}" "version"="{{ index $context "image_version" }}"
{{ end }}
{{ end }}
{{ end }}

# Add packages
ADD packages /var/vcap/packages/

# Add job sources
ADD jobs /var/vcap/jobs-src/

# Add run.sh
ADD run.sh /opt/hcf/

{{ with .license }}
# Add license file
ADD {{.}} /opt/hcf/share/doc/
{{ end }}
{{ with .notice }}
# Add notice file
ADD {{.}} /opt/hcf/share/doc/
{{ end }}

ENTRYPOINT ["/opt/hcf/run.sh"]
